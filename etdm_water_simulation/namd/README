#!/bin/csh
#

# Generated by CHARMM-GUI (http://www.charmm-gui.org) v2.0
#
# The following shell script assumes your NAMD executable is namd2 and that
# the NAMD inputs are located in the current directory.
#
# Only one processor is used below. To parallelize NAMD, use this scheme:
#     charmrun namd2 +p4 input_file.inp > output_file.out
# where the "4" in "+p4" is replaced with the actual number of processors you
# intend to use.

# Running equilibration step
namd2 step4_equilibration.inp > step4_equilibration.out

# Running production for 10 nanoseconds
set cnt    = 1
set cntmax = 10

while ( ${cnt} <= ${cntmax} )
    # create appropriate input file using step5_production.inp as template
    if ( ${cnt} == 1 ) then
        set outputname = "step5_${cnt}"
        # change only the output name
        sed "s/step5_production/${outputname}/" step5_production.inp > step5_run.inp
    else
        @ cntprev = ${cnt} - 1
        set inputname = "step5_${cntprev}"
        set outputname = "step5_${cnt}"
        # change input and output names from template file
        sed "s/step4_equilibration/${inputname}/" step5_production.inp | \
            sed "s/step5_production/${outputname}/" > step5_run.inp
    endif

    # run the simulation for 1 nanosecond
    namd2 step5_run.inp > ${outputname}.out

    @ cnt += 1
end

